# UnifiedGraphTool 実装計画書

## 概要
統合関数グラフツールの詳細な実装計画と、既存教材からの機能統合マッピングを記載します。

## 実装フェーズ

### フェーズ1: 基盤構築（5日間）

#### Day 1: プロジェクト構造の作成
- [ ] ディレクトリ構造の作成
- [ ] 基本的な型定義（types.ts）
- [ ] 定数定義（constants.ts）
- [ ] 設定ファイルの準備

#### Day 2: 共通グラフエンジンの開発
- [ ] GraphEngine クラスの実装
- [ ] 座標変換ユーティリティ
- [ ] 描画基本機能（軸、グリッド、目盛り）
- [ ] Canvas操作の抽象化

#### Day 3: 関数評価システム
- [ ] FunctionEvaluator の実装
- [ ] 各種関数タイプのサポート
  - 一次関数
  - 二次関数
  - 三次関数
  - 三角関数
  - 指数・対数関数
- [ ] 数式パーサーの実装

#### Day 4: UI基本コンポーネント
- [ ] GraphCanvas コンポーネント
- [ ] ControlPanel の基本レイアウト
- [ ] ModeSelector の実装
- [ ] 基本的なスタイリング

#### Day 5: 学年別設定システム
- [ ] GradeConfig の実装
- [ ] 機能の段階的開放システム
- [ ] 学年切り替えロジック

### フェーズ2: 既存機能の移植（5日間）

#### Day 6-7: FunctionGraphTool からの移植
移植する機能:
- パラメータスライダーシステム
- アニメーション機能
- 関数タイプ選択UI
- クイズモード（問題生成・回答チェック）

```typescript
// 既存コードから抽出する主要機能
- calculateFunction() -> FunctionEvaluator に統合
- drawGraph() -> GraphEngine に統合
- animate() -> useAnimation フックに移植
- generateQuiz() / checkAnswer() -> useQuizLogic に移植
```

#### Day 8: LinearFunctionGrapher からの移植
移植する機能:
- 2点通過モードのロジック
- 実生活例（タクシー料金、携帯電話料金など）
- 交点計算機能
- 切片表示機能

```typescript
// 既存コードから抽出する主要機能
- calculateLineFromTwoPoints() -> mathCalculations.ts
- calculateIntersection() -> mathCalculations.ts
- realLifeExamples オブジェクト -> config/realLifeExamples.ts
```

#### Day 9-10: QuadraticFunctionGraph からの移植
移植する機能:
- 頂点・軸の計算と表示
- 標準形への変換
- 判別式の計算
- 変形過程の表示

```typescript
// 既存コードから抽出する主要機能
- getVertex() -> mathCalculations.ts
- getStandardForm() -> mathCalculations.ts
- getDiscriminant() -> mathCalculations.ts
```

### フェーズ3: 新機能実装（3日間）

#### Day 11: ガイド付き学習モード
- [ ] ステップ管理システム
- [ ] ヒント表示機能
- [ ] 進捗トラッキング
- [ ] チュートリアルオーバーレイ

#### Day 12: 拡張インタラクション
- [ ] グラフのパン・ズーム機能
- [ ] 複数関数の同時表示
- [ ] 関数の比較モード
- [ ] スナップショット機能

#### Day 13: 学習分析機能
- [ ] 学習履歴の記録
- [ ] 理解度の可視化
- [ ] 推奨学習パスの提示

### フェーズ4: 統合とテスト（2日間）

#### Day 14: 統合テスト
- [ ] 各学年モードの動作確認
- [ ] パフォーマンステスト
- [ ] エラーハンドリングの確認
- [ ] アクセシビリティチェック

#### Day 15: 最終調整
- [ ] バグ修正
- [ ] UI/UXの微調整
- [ ] ドキュメント作成
- [ ] デモの準備

## 既存教材からの機能マッピング

### FunctionGraphTool (高校1年生向け)
| 既存機能 | 統合先 | 優先度 |
|---------|--------|--------|
| 7種類の関数タイプ | FunctionConfigs | 高 |
| パラメータアニメーション | AnimationControls | 高 |
| クイズモード | QuizPanel | 中 |
| カスタム関数入力 | 将来拡張 | 低 |

### LinearFunctionGrapher (中学2年生向け)
| 既存機能 | 統合先 | 優先度 |
|---------|--------|--------|
| 2点通過モード | ControlPanel | 高 |
| 実生活例 | RealLifePanel | 高 |
| 交点計算 | GraphInfo | 中 |
| 表示設定（グリッド等） | DisplayOptions | 中 |

### QuadraticFunctionGraph (中学3年生向け)
| 既存機能 | 統合先 | 優先度 |
|---------|--------|--------|
| 頂点・軸表示 | GraphInfo | 高 |
| 標準形変換 | GraphInfo | 中 |
| アニメーション | AnimationControls | 高 |
| クリックで座標表示 | GraphCanvas | 中 |

## 技術的考慮事項

### パフォーマンス最適化
1. **Canvas最適化**
   - requestAnimationFrame の適切な使用
   - 不要な再描画の防止
   - オフスクリーンCanvas の活用

2. **計算の最適化**
   - 関数値のメモ化
   - Web Worker での重い計算
   - 描画範囲の最適化

3. **メモリ管理**
   - 不要なオブジェクトの解放
   - イベントリスナーのクリーンアップ
   - 大きな配列の効率的な管理

### アクセシビリティ
- キーボードナビゲーション
- スクリーンリーダー対応
- 高コントラストモード
- フォーカス管理

### 互換性
- モバイル対応（タッチ操作）
- 異なる画面サイズへの対応
- 古いブラウザのフォールバック

## リスクと対策

### 技術的リスク
1. **Canvas パフォーマンス**
   - リスク: 複雑なグラフで描画が遅くなる
   - 対策: レベル・オブ・ディテール（LOD）の実装

2. **メモリリーク**
   - リスク: 長時間使用でメモリ使用量が増加
   - 対策: 適切なクリーンアップとメモリプロファイリング

### 教育的リスク
1. **複雑さの管理**
   - リスク: 機能が多すぎて使いにくい
   - 対策: 学年別の段階的機能開放

2. **学習曲線**
   - リスク: 操作が難しくて挫折
   - 対策: チュートリアルとヘルプの充実

## 成功指標

### 技術的指標
- 初期読み込み時間: 3秒以内
- グラフ描画: 60fps維持
- メモリ使用量: 100MB以下

### 教育的指標
- 各学年での理解度向上率
- 継続使用率
- 学習目標達成率

## 次のステップ

1. この実装計画のレビューと承認
2. 開発環境の準備
3. フェーズ1の開始
4. 週次進捗レビューの設定

## 更新履歴
- 2025-06-29: 初版作成